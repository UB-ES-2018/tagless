extends layout
block stylesheets
    link(href='/static/stylesheets/bootstrap.min.css', rel='stylesheet')
    link(href='/static/stylesheets/blog-home.css', rel='stylesheet')
    link(href='/static/stylesheets/user.css', rel='stylesheet')
    link(href="/static/open-iconic/font/css/open-iconic-bootstrap.css" rel="stylesheet")
    //link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css" integrity="sha256-BJ/G+e+y7bQdrYkS2RBTyNfBHpA9IuGaPmf9htub5MQ=" crossorigin="anonymous")

block content
    include ../elements/navbar
    .container
        .row
            // Blog Entries Column
            .col-md-8
                block main
            include ../elements/sidebar
    footer.py-5.bg-dark
        .container
            p.m-0.text-center.text-white Copyright &copy; Your Website 2018
        // /.container

block script
    // Bootstrap core JavaScript
    script(src='/static/javascripts/jquery.min.js')
    script(src='/static/javascripts/bootstrap.bundle.min.js')
    script(src="https://cloud.tinymce.com/stable/tinymce.min.js?apiKey=1tue646zh3a7tplbspb5dzyasxkrfls6t5v85f9uqegvj55b")
    script tinymce.init({ selector:'textarea' });

    script(type="text/javascript").
        $(document).ready(function () {
            $('.vote').click(function (){
                var button, inverse_element_id, value;
                var this_element = $($(this)[0]);
                console.log($(this)[0]);
                if (this_element.hasClass("thread")){
                    var url = "/api/vote/thread";
                    var element_id = this_element.attr("data-thread-id");
                    var karma = $("#thread-karma" + element_id);

                    if (this_element.hasClass("upvote")){
                        inverse_element_id = $($(".downvote.thread[data-thread-id='" + element_id + "']")[0]);
                        value = this_element.hasClass('upvoted') ? 0 : 1;
                    }else{
                        inverse_element_id = $($(".upvote.thread[data-thread-id='" + element_id + "']")[0]);
                        value = this_element.hasClass('downvoted') ? 0 : -1;
                    }

                }else if (this_element.hasClass("comment")){
                    var url = "/api/vote/comment";
                    var element_id = this_element.attr("data-comment-id");
                    var karma = $("#comment-karma" + element_id);

                    if (this_element.hasClass("upvote")) {
                        inverse_element_id = $($(".downvote.comment[data-comment-id='" + element_id + "']")[0]);
                        value = this_element.hasClass('upvoted') ? 0 : 1;
                    } else {
                        inverse_element_id = $($(".upvote.comment[data-comment-id='" + element_id + "']")[0]);
                        value = this_element.hasClass('downvoted') ? 0 : -1;
                    }
                }

                $.post(url, {
                    val: value,
                    id: element_id
                }).done(function (data) {
                    if (data.user_vote == 1) this_element.addClass('upvoted');
                    else if (data.user_vote == -1) this_element.addClass('downvoted');
                    else {
                        this_element.removeClass('upvoted');
                        this_element.removeClass('downvoted');
                    }
                    inverse_element_id.removeClass("downvoted");
                    inverse_element_id.removeClass("upvoted");
                    karma.text(data.total);
                }).fail(function (data) {
                    alert("Error");
                });
            });

        });